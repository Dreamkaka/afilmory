# ActionGroup 优化实现总结

## 📋 实现的改动

### 1. **合并搜索和过滤功能**

#### 之前的设计问题：
- ❌ 搜索和过滤是两个独立按钮
- ❌ Filter 中使用 Tab 切换（标签、相机、镜头、评分）
- ❌ 功能分散，操作层级过深
- ❌ 按钮数量过多（5个），桌面端空间不足

#### 优化后的设计：
- ✅ **统一搜索面板** (`UnifiedSearchPanel`)
- ✅ 使用**预设按钮**替代 Tab 界面
- ✅ 顶部快速切换：全部、标签、相机、镜头、评分
- ✅ 减少顶层按钮至 **3 个**：搜索/过滤、地图、视图

---

## 🎨 新的 UI 结构

### 按钮布局（从左到右）
```
[🔍 搜索/过滤] [🗺️ 地图探索] [⚙️ 视图设置]
```

### 统一搜索面板布局
```
┌─────────────────────────────────────┐
│ 搜索和筛选            [清除]         │
├─────────────────────────────────────┤
│ [搜索输入框]                         │
├─────────────────────────────────────┤
│ [全部] [标签²] [相机¹] [镜头] [评分] │ ← 预设按钮
├─────────────────────────────────────┤
│                                     │
│  【根据预设显示不同内容】            │
│                                     │
│  - 全部: 照片搜索结果                │
│  - 标签: 标签列表 + 匹配模式          │
│  - 相机: 相机列表                    │
│  - 镜头: 镜头列表                    │
│  - 评分: 星级评分选择器               │
│                                     │
└─────────────────────────────────────┘
```

---

## 📁 新增文件

### `apps/web/src/components/gallery/UnifiedSearchPanel.tsx`

**核心组件：**
- `UnifiedSearchPanel` - 主面板组件
- `FilterList` - 通用过滤列表组件
- `StarRating` - 星级评分组件

**关键特性：**
1. **预设系统**：5 种预设（全部、标签、相机、镜头、评分）
2. **统一搜索**：全局照片搜索（标题、描述、标签、EXIF）
3. **快速过滤**：每个类别独立的项目搜索
4. **智能 Badge**：显示激活的过滤器数量
5. **一键清除**：重置所有搜索和过滤条件

---

## 🔄 修改的文件

### 1. `apps/web/src/modules/gallery/ActionGroup.tsx`

**主要改动：**
- ✅ 导入 `UnifiedSearchPanel` 替代 `FilterPanel`
- ✅ 移除独立的"过滤"按钮
- ✅ 移除旧的 `SearchPanel` 组件
- ✅ 合并搜索和过滤逻辑
- ✅ 更新 badge 计算逻辑

**Button 减少：**
```diff
- [搜索] [地图] [过滤] [列数] [排序]  // 5个按钮
+ [搜索/过滤] [地图] [视图]          // 3个按钮
```

### 2. 国际化文件（i18n）

**新增翻译键：**
```json
{
  "action.search.unified.title": "Search & Filter",
  "action.search.preset.all": "All",
  "action.search.filter.placeholder": "Filter items...",
  "action.search.filter.no-results": "No matches found"
}
```

**支持的语言：**
- ✅ English (`en.json`)
- ✅ 简体中文 (`zh-CN.json`)
- ✅ 繁体中文-台湾 (`zh-TW.json`)
- ✅ 繁体中文-香港 (`zh-HK.json`)
- ✅ 日本語 (`jp.json`)
- ✅ 한국어 (`ko.json`)

---

## 🎯 用户体验提升

### 操作流程简化

**之前：**
1. 点击"过滤"按钮
2. 点击 Tab 切换类别（标签/相机/镜头/评分）
3. 搜索或选择项目
4. 返回，点击"搜索"按钮
5. 输入关键词

**现在：**
1. 点击"搜索/过滤"按钮
2. 输入关键词（全局搜索）或点击预设
3. 立即查看结果

### 交互优化

1. **预设按钮**
   - 一键切换不同过滤类型
   - Badge 显示激活数量
   - 激活状态有明显视觉反馈

2. **搜索体验**
   - 全局搜索：匹配标题、描述、标签、EXIF
   - 类别搜索：在列表中快速筛选
   - 实时结果展示

3. **Badge 系统**
   - 搜索激活：显示 `●`
   - 过滤激活：显示数字（如 `3`）
   - 一目了然的状态提示

---

## 💡 设计理念

### 信息架构优化

**旧架构（平铺）：**
```
搜索 | 地图 | 过滤(Tab:标签/相机/镜头/评分) | 列数 | 排序
```

**新架构（分组）：**
```
搜索/过滤(预设:全部/标签/相机/镜头/评分) | 地图 | 视图(排序+列数)
```

### 原则：
1. **功能聚合**：相关功能合并到同一入口
2. **预设替代 Tab**：减少交互层级
3. **扁平化**：主要操作一步到位
4. **扩展性**：预设系统易于添加新类型

---

## 🔮 未来扩展方向

### 可能的新预设
- 📅 **日期范围**：按拍摄日期筛选
- 📍 **地理位置**：按拍摄地点筛选
- 🎨 **颜色**：按主色调筛选
- 📸 **参数**：按光圈、快门、ISO 筛选

### 可能的功能增强
- 💾 **保存预设**：自定义常用过滤组合
- 🔄 **搜索历史**：快速访问之前的搜索
- 🏷️ **智能建议**：根据输入提示相关标签

---

## 📊 技术实现亮点

### 1. 组件复用
```typescript
<FilterList
  items={allTags}
  selectedItems={selectedTags}
  onToggle={toggleTag}
  showMatchMode  // 仅标签支持
/>
```

### 2. 状态管理
- 使用 Jotai 全局状态
- 预设切换本地状态
- 过滤器持久化

### 3. 性能优化
- `useMemo` 缓存搜索结果
- `useCallback` 防止重渲染
- 虚拟滚动（如需要可添加）

### 4. 响应式设计
- 桌面端：下拉菜单
- 移动端：底部抽屉
- 自适应宽度和高度

---

## ✅ 实现检查清单

- [x] 创建 `UnifiedSearchPanel` 组件
- [x] 更新 `ActionGroup` 使用新面板
- [x] 移除旧的 Tab 界面
- [x] 添加预设按钮系统
- [x] 实现过滤列表组件
- [x] 添加国际化支持（6种语言）
- [x] 更新 badge 逻辑
- [x] 保持响应式设计
- [x] 创建设计文档

---

## 📝 使用指南

### 对于用户
1. 点击搜索图标打开面板
2. 输入关键词或点击预设按钮
3. 查看结果或选择过滤项
4. Badge 显示激活的过滤器数量

### 对于开发者
1. 新预设添加位置：`UnifiedSearchPanel.tsx` 的 `presets` 数组
2. 修改过滤逻辑：更新 `FilterList` 组件
3. 添加新的过滤类型：扩展 `SearchPreset` 类型

---

## 🎉 总结

这次优化成功地：
- ✅ **简化了 UI**：从 5 个按钮减少到 3 个
- ✅ **提升了效率**：减少点击层级
- ✅ **增强了扩展性**：预设系统易于添加新功能
- ✅ **改善了体验**：搜索和过滤统一入口
- ✅ **保持了一致性**：与现有设计风格匹配

预设按钮系统比 Tab 界面更加直观和高效！🚀
